<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BAYYTI-B1 Smart Irrigation System</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,300..900;1,300..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/dashboard.css?v=4.0">
    <link rel="stylesheet" href="css/irrigation-sidebar.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Global Loader -->
    <div class="global-loader" id="globalLoader">
        <div class="loader-content">
            <i class="fa-solid fa-spinner loader-icon"></i>
            <div class="loader-text">Loading...</div>
        </div>
    </div>

    <script>
        // Check if setup is complete, redirect to setup if not
        if (!localStorage.getItem('bayyti_setup_complete')) {
            window.location.href = 'setup.html';
        }
    </script>
    <!-- Red Header Bar (BleuHive Style) -->
    <header class="top-header">
        <div class="header-container">
            <button class="mobile-menu-btn" id="mobile-menu-btn" aria-label="Menu">
                <i class="fa-solid fa-ellipsis-vertical"></i>
            </button>
            <div class="header-left">
                <div class="logo logo-setup-container">
                    <img src="logosetup.png" alt="BAYYTI Logo" class="logo-setup-image">
                </div>
            </div>
            <div class="header-center">
                <h1 class="project-title">Smart Irrigation Control Project <strong>BAYYTI-B1</strong></h1>
                <div class="header-datetime" id="header-datetime">
                    <i class="fa-solid fa-clock"></i>
                    <span id="header-time">--:--</span>
                    <span class="datetime-separator">‚Ä¢</span>
                    <span id="header-date">--- --, ----</span>
                </div>
            </div>
            <div class="header-right">
                <button class="header-icon-btn" id="alertBtn" title="Alerts & Warnings">
                    <i class="fa-solid fa-triangle-exclamation"></i>
                    <span class="alert-counter" id="alertCounter">0</span>
                </button>
                <button class="header-icon-btn" id="notificationBtn" title="System Notifications">
                    <i class="fa-solid fa-bell"></i>
                    <span class="notification-badge" id="notificationBadge">0</span>
                </button>
                <button class="header-icon-btn" id="updateBtnMain" title="Check for system updates">
                    <i class="fa-solid fa-rotate"></i>
                    <span class="update-indicator" id="updateIndicator"></span>
                </button>
                <a href="space.html" class="header-icon-btn" title="Space Dashboard">
                    <i class="fa-solid fa-rocket"></i>
                </a>
                <a href="analytics.html" class="header-icon-btn" title="View Analytics Dashboard">
                    <i class="fa-solid fa-chart-line"></i>
                </a>
                <a href="emergency.html" class="header-icon-btn" title="Emergency Controls" style="background: rgba(220, 53, 69, 0.2);">
                    <i class="fa-solid fa-fire-extinguisher"></i>
                </a>
                <a href="hardware.html" class="header-icon-btn" title="Hardware Schema">
                    <i class="fa-solid fa-microchip"></i>
                </a>
                <a href="controls.html" class="header-icon-btn" title="User & System Controls">
                    <i class="fa-solid fa-sliders"></i>
                </a>
                <a href="ai.html" class="header-icon-btn" title="AI Model Testing">
                    <i class="fa-solid fa-brain"></i>
                </a>
                <a href="support.html" class="header-icon-btn" title="Support">
                    <i class="fa-solid fa-circle-question"></i>
                </a>
                <a href="faq.html" class="header-icon-btn" title="FAQ">
                    <i class="fa-solid fa-book"></i>
                </a>
                <a href="#" class="header-icon-btn" id="setup-link" aria-label="Return to Setup" title="Return to Setup">
                    <i class="fa-solid fa-gear"></i>
                </a>
                <button class="header-icon-btn reboot-btn" id="rebootBtn" title="Reboot System">
                    <i class="fa-solid fa-power-off"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Mobile Sidebar Menu -->
    <div class="mobile-sidebar" id="mobile-sidebar">
        <div class="sidebar-overlay" id="sidebar-overlay"></div>
        <div class="sidebar-content">
            <div class="sidebar-header">
                <button class="sidebar-close" id="sidebar-close" aria-label="Close Menu">
                    <i class="fa-solid fa-times"></i>
                </button>
            </div>
            <nav class="sidebar-nav">
                <a href="index.html" class="sidebar-item active" title="Dashboard">
                    <i class="fa-solid fa-gauge"></i>
                </a>
                <a href="space.html" class="sidebar-item" title="Space Dashboard">
                    <i class="fa-solid fa-rocket"></i>
                </a>
                <a href="analytics.html" class="sidebar-item" title="Analytics">
                    <i class="fa-solid fa-chart-line"></i>
                </a>
                <a href="emergency.html" class="sidebar-item" title="Emergency Controls">
                    <i class="fa-solid fa-fire-extinguisher"></i>
                </a>
                <a href="hardware.html" class="sidebar-item" title="Hardware Schema">
                    <i class="fa-solid fa-microchip"></i>
                </a>
                <a href="controls.html" class="sidebar-item" title="User & System Controls">
                    <i class="fa-solid fa-sliders"></i>
                </a>
                <a href="ai.html" class="sidebar-item" title="AI Model Testing">
                    <i class="fa-solid fa-brain"></i>
                </a>
                <a href="support.html" class="sidebar-item" title="Support">
                    <i class="fa-solid fa-circle-question"></i>
                </a>
                <button class="sidebar-item" id="rebootBtnMobile" title="Reboot System">
                    <i class="fa-solid fa-power-off"></i>
                </button>
            </nav>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Irrigation Timer Sidebar -->
        <aside class="irrigation-sidebar">
            <div class="irrigation-header">
                <i class="fa-solid fa-droplet"></i>
                <h3>Irrigation Time</h3>
            </div>
            
            <div class="circular-progress-container">
                <svg class="circular-progress" viewBox="0 0 200 200">
                    <circle class="progress-bg" cx="100" cy="100" r="85"></circle>
                    <circle class="progress-bar" cx="100" cy="100" r="85" id="irrigation-progress-circle"></circle>
                </svg>
                <div class="progress-content">
                    <div class="progress-value" id="irrigation-minutes">0</div>
                    <div class="progress-label">Minutes</div>
                    <div class="progress-sublabel">Today</div>
                </div>
            </div>
            
            <div class="irrigation-divider"></div>
            
            <div class="irrigation-stats">
                <div class="stat-item">
                    <div class="stat-icon">
                        <i class="fa-solid fa-valve"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-label">Valve Opens</div>
                        <div class="stat-value" id="valve-open-count">0</div>
                    </div>
                </div>
                
                <div class="stat-item">
                    <div class="stat-icon">
                        <i class="fa-solid fa-clock"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-label">Avg Duration</div>
                        <div class="stat-value" id="avg-duration">0 min</div>
                    </div>
                </div>
                
                <div class="stat-item">
                    <div class="stat-icon">
                        <i class="fa-solid fa-water"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-label">Water Used</div>
                        <div class="stat-value" id="water-used-today">0 L</div>
                    </div>
                </div>
            </div>
            
            <div class="irrigation-status" id="irrigation-status">
                <div class="status-indicator status-idle"></div>
                <span>Idle</span>
            </div>
        </aside>
        
        <div class="main-content-wrapper">
        <!-- Page Title -->
        <div class="page-title-section">
            <div class="page-title-icon">
                <i class="fa-solid fa-gauge-high"></i>
            </div>
            <h1 class="page-title">Dashboard</h1>
        </div>
        
        <!-- Real-Time Sensor Data Grid -->
        <div class="sensor-grid">
            <div class="sensor-card">
                <div class="sensor-icon soil">
                    <i class="fa-solid fa-seedling"></i>
                </div>
                <div class="sensor-content">
                    <div class="sensor-label">Soil Moisture</div>
                    <div class="sensor-value" id="soil-moisture">--</div>
                    <div class="sensor-unit">%</div>
                    <div class="sensor-status" id="soil-status">Loading...</div>
                </div>
            </div>

            <div class="sensor-card">
                <div class="sensor-icon temp">
                    <i class="fa-solid fa-temperature-half"></i>
                    </div>
                <div class="sensor-content">
                    <div class="sensor-label">Temperature</div>
                    <div class="sensor-value" id="temperature">--</div>
                    <div class="sensor-unit">¬∞C</div>
                    <div class="sensor-status" id="temp-status">Loading...</div>
                </div>
                    </div>

            <div class="sensor-card">
                <div class="sensor-icon humidity">
                    <i class="fa-solid fa-droplet"></i>
                    </div>
                <div class="sensor-content">
                    <div class="sensor-label">Humidity</div>
                    <div class="sensor-value" id="humidity">--</div>
                    <div class="sensor-unit">%</div>
                    <div class="sensor-status" id="humidity-status">Loading...</div>
                </div>
                    </div>

            <div class="sensor-card">
                <div class="sensor-icon battery">
                    <i class="fa-solid fa-battery-three-quarters"></i>
                    </div>
                <div class="sensor-content">
                    <div class="sensor-label">Battery Level</div>
                    <div class="sensor-value" id="battery">--</div>
                    <div class="sensor-unit">%</div>
                    <div class="sensor-status" id="battery-status">Loading...</div>
                </div>
                    </div>

            <div class="sensor-card">
                <div class="sensor-icon solar">
                    <i class="fa-solid fa-solar-panel"></i>
                    </div>
                <div class="sensor-content">
                    <div class="sensor-label">Solar Status</div>
                    <div class="sensor-value" id="solar-status">--</div>
                    <div class="sensor-unit"></div>
                    <div class="sensor-status" id="solar-text">Loading...</div>
                </div>
            </div>

            <div class="sensor-card">
                <div class="sensor-icon water">
                    <i class="fa-solid fa-faucet"></i>
                    </div>
                <div class="sensor-content">
                    <div class="sensor-label">Water Flow</div>
                    <div class="sensor-value" id="flow-rate">--</div>
                    <div class="sensor-unit">L/min</div>
                    <div class="sensor-status" id="flow-status">Loading...</div>
                            </div>
                        </div>
                    </div>

        <!-- Control Panel -->
        <div class="control-section">
            <div class="control-card">
                <div class="card-header">
                    <h3><i class="fa-solid fa-valve"></i> Irrigation Control</h3>
                    <span class="valve-badge" id="valve-badge">OFF</span>
                </div>
                <div class="card-body">
                    <div class="control-buttons">
                        <button class="btn btn-success" id="start-irrigation">
                            <i class="fa-solid fa-play"></i> Start Irrigation
                        </button>
                        <button class="btn btn-danger" id="stop-irrigation">
                            <i class="fa-solid fa-stop"></i> Stop Irrigation
                        </button>
                        <button class="btn btn-warning" id="emergency-stop">
                            <i class="fa-solid fa-circle-exclamation"></i> Emergency Stop
                        </button>
                    </div>
                    <div class="irrigation-info">
                        <div class="info-item">
                            <span class="info-label">Duration:</span>
                            <span class="info-value" id="irrigation-duration">--</span>
                            </div>
                        <div class="info-item">
                            <span class="info-label">Water Used:</span>
                            <span class="info-value" id="water-used">--</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Last Irrigation:</span>
                            <span class="info-value" id="last-irrigation">--</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="control-card">
                <div class="card-header">
                    <h3><i class="fa-solid fa-brain"></i> AI Recommendation</h3>
                    <label class="toggle-switch">
                        <input type="checkbox" id="auto-mode">
                        <span class="toggle-slider"></span>
                        <span class="toggle-label">Auto Mode</span>
                    </label>
                </div>
                <div class="card-body">
                    <div class="ai-recommendation" id="ai-recommendation">
                        <div class="recommendation-loading">
                            <i class="fa-solid fa-spinner fa-spin"></i> Loading AI recommendation...
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Zones Display -->
        <div class="zones-section" id="zones-section">
            <h2><i class="fa-solid fa-layer-group"></i> Irrigation Zones</h2>
            <div class="zones-grid" id="zones-grid">
                <!-- Zones will be dynamically loaded -->
            </div>
                    </div>

        <!-- Charts Section -->
        <div class="charts-section">
            <!-- Statistics Overview Cards -->
            <div class="stats-overview">
                <div class="stat-card temp-stat">
                    <div class="stat-icon">
                        <i class="fa-solid fa-temperature-half"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Temperature Avg</div>
                        <div class="stat-value" id="temp-avg">--</div>
                        <div class="stat-unit">¬∞C</div>
                        <div class="stat-trend" id="temp-trend">--</div>
                    </div>
                </div>
                
                <div class="stat-card humidity-stat">
                    <div class="stat-icon">
                        <i class="fa-solid fa-droplet"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Humidity Avg</div>
                        <div class="stat-value" id="humidity-avg">--</div>
                        <div class="stat-unit">%</div>
                        <div class="stat-trend" id="humidity-trend">--</div>
                    </div>
                </div>
                
                <div class="stat-card irrigation-stat">
                    <div class="stat-icon">
                        <i class="fa-solid fa-faucet"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Irrigation Time</div>
                        <div class="stat-value" id="irrigation-total">--</div>
                        <div class="stat-unit">min</div>
                        <div class="stat-trend" id="irrigation-trend">--</div>
                    </div>
                </div>
                
                <div class="stat-card moisture-stat">
                    <div class="stat-icon">
                        <i class="fa-solid fa-seedling"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Soil Moisture Avg</div>
                        <div class="stat-value" id="moisture-avg">--</div>
                        <div class="stat-unit">%</div>
                        <div class="stat-trend" id="moisture-trend">--</div>
                    </div>
                </div>
            </div>
            
            <!-- Main Chart: Combined Temperature, Humidity & Irrigation -->
            <div class="chart-card chart-main">
                <div class="card-header">
                    <h3><i class="fa-solid fa-chart-mixed"></i> Real-Time Environmental Data (24h)</h3>
                    <div class="chart-controls">
                        <button class="chart-btn active" data-range="24h">24h</button>
                        <button class="chart-btn" data-range="7d">7d</button>
                        <button class="chart-btn" data-range="30d">30d</button>
                    </div>
                </div>
                <div class="card-body">
                    <canvas id="combined-chart"></canvas>
                </div>
            </div>
            
            <!-- Secondary Charts Grid -->
            <div class="charts-grid">
                <div class="chart-card">
                    <div class="card-header">
                        <h3><i class="fa-solid fa-chart-line"></i> Temperature Trends</h3>
                    </div>
                    <div class="card-body">
                        <canvas id="temp-chart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <div class="card-header">
                        <h3><i class="fa-solid fa-chart-area"></i> Humidity & Irrigation</h3>
                    </div>
                    <div class="card-body">
                        <canvas id="humidity-irrigation-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Status -->
        <div class="status-section">
            <div class="status-card">
                <div class="card-header">
                    <h3><i class="fa-solid fa-shield-halved"></i> Safety Status</h3>
                </div>
                <div class="card-body">
                    <div class="status-grid" id="safety-status-grid">
                        <div class="status-item">
                            <i class="fa-solid fa-spinner fa-spin"></i>
                            <span>Loading Safety Status...</span>
                    </div>
                    </div>
                </div>
            </div>

            <div class="status-card">
                <div class="card-header">
                    <h3><i class="fa-solid fa-clock-rotate-left"></i> Recent Activity</h3>
                </div>
                <div class="card-body">
                    <div class="activity-list" id="activity-list">
                        <!-- Activity items will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Irrigation Schedule Sidebar -->
        <aside class="schedule-sidebar">
            <div class="schedule-header">
                <i class="fa-solid fa-calendar-days"></i>
                <h3>Irrigation Tasks</h3>
                <span class="schedule-badge" id="schedule-badge">Last 7 days</span>
            </div>
            
            <div class="schedule-table-container">
                <table class="schedule-table">
                    <thead>
                        <tr>
                            <th>Start day</th>
                            <th>Start time</th>
                            <th>Duration</th>
                            <th>Volume</th>
                            <th>Progress</th>
                        </tr>
                    </thead>
                    <tbody id="schedule-table-body">
                        <tr>
                            <td colspan="5" class="schedule-loading">
                                <i class="fa-solid fa-spinner fa-spin"></i>
                                <span>Loading schedule...</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </aside>
    </div>

    <!-- Clean Black Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-info">
                <h3>BAYYTI-B1</h3>
                <p>Smart Irrigation System ‚Ä¢ Powered by AI</p>
            </div>
            <div class="footer-links">
                <a href="index.html">Dashboard</a>
                <a href="analytics.html">Analytics</a>
                <a href="emergency.html">Emergency</a>
                <a href="hardware.html">Hardware</a>
                <a href="controls.html">Controls</a>
                <a href="ai.html">AI Testing</a>
                <a href="support.html">Support</a>
            </div>
            <div class="footer-status">
                <p><strong>v1.0.0</strong> ‚Ä¢ <span class="status-online">‚óè Online</span></p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 BAYYTI. All rights reserved.</p>
        </div>
    </footer>

    <!-- Notification Panel -->
    <div class="notification-panel" id="notificationPanel">
        <div class="notification-header">
            <h3><i class="fa-solid fa-bell"></i> Notifications</h3>
            <button class="close-panel" onclick="closeNotificationPanel()">
                <i class="fa-solid fa-times"></i>
            </button>
        </div>
        <div class="notification-list" id="notificationList">
            <!-- Notifications will be loaded here -->
        </div>
    </div>

    <!-- Custom Modal/Popup -->
    <div id="custom-modal" class="custom-modal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <i class="fa-solid fa-exclamation-triangle modal-icon"></i>
                <h3 class="modal-title">Return to Setup</h3>
            </div>
            <div class="modal-body">
                <p>This will reset your current setup configuration. Are you sure you want to continue?</p>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-cancel" id="modal-cancel">
                    <i class="fa-solid fa-times"></i>
                    <span>Cancel</span>
                </button>
                <button class="modal-btn modal-btn-confirm" id="modal-confirm">
                    <i class="fa-solid fa-check"></i>
                    <span>Confirm</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Update Modal -->
    <div id="updateModal" class="custom-modal" style="display: none;">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <i class="fa-solid fa-rotate modal-icon"></i>
                <h3 class="modal-title">System Update</h3>
            </div>
            <div class="modal-body" id="updateModalBody">
                <p>Checking for updates...</p>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-cancel" id="updateModalCancel">
                    <i class="fa-solid fa-times"></i>
                    <span>Close</span>
                </button>
                <button class="modal-btn modal-btn-confirm" id="installUpdateBtn" style="display: none;">
                    <i class="fa-solid fa-download"></i>
                    <span>Install Update</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Reboot Confirmation Modal -->
    <div id="rebootModal" class="custom-modal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <i class="fa-solid fa-power-off modal-icon"></i>
                <h3 class="modal-title">Reboot System</h3>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to reboot the BAYYTI-B1 system?</p>
                <p style="color: #FFC107; margin-top: 1rem;">
                    <i class="fa-solid fa-triangle-exclamation"></i>
                    This will temporarily interrupt irrigation operations.
                </p>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-cancel" id="rebootModalCancel">
                    <i class="fa-solid fa-times"></i>
                    <span>Cancel</span>
                </button>
                <button class="modal-btn modal-btn-confirm" id="confirmRebootBtn">
                    <i class="fa-solid fa-power-off"></i>
                    <span>Reboot Now</span>
                </button>
            </div>
        </div>
    </div>

    <script src="js/dashboard.js?v=4.0"></script>
    <script>
        // Update System Integration
        const API_BASE = 'http://localhost:5000/api';
        const CURRENT_VERSION = '1.0.0';

        function setupUpdateSystem() {
            const updateBtn = document.getElementById('updateBtnMain');
            const modal = document.getElementById('updateModal');
            const cancelBtn = document.getElementById('updateModalCancel');
            const installBtn = document.getElementById('installUpdateBtn');

            if (!updateBtn) return;

            updateBtn.addEventListener('click', checkForUpdates);
            if (cancelBtn) cancelBtn.addEventListener('click', () => modal.style.display = 'none');
            if (installBtn) installBtn.addEventListener('click', installUpdate);

            // Auto-check on page load
            setTimeout(checkForUpdatesQuiet, 3000);
        }

        async function checkForUpdatesQuiet() {
            try {
                const response = await fetch(`${API_BASE}/system/update/check`);
                const data = await response.json();
                
                if (data.success && data.update_available) {
                    const statusEl = document.getElementById('updateStatusMain');
                    if (statusEl) {
                        statusEl.textContent = '‚Ä¢';
                        statusEl.style.color = '#f44336';
                    }
                    const updateBtn = document.getElementById('updateBtnMain');
                    if (updateBtn) updateBtn.style.background = 'rgba(244, 67, 54, 0.1)';
                }
            } catch (error) {
                console.error('Update check failed:', error);
            }
        }

        async function checkForUpdates() {
            const modal = document.getElementById('updateModal');
            const modalBody = document.getElementById('updateModalBody');
            const installBtn = document.getElementById('installUpdateBtn');
            
            modal.style.display = 'flex';
            modalBody.innerHTML = '<p><i class="fa-solid fa-spinner fa-spin"></i> Checking for updates...</p>';
            
            try {
                const response = await fetch(`${API_BASE}/system/update/check`);
                const data = await response.json();
                
                if (data.success && data.update_available) {
                    modalBody.innerHTML = `
                        <div class="update-info">
                            <p><strong>üéâ New version available: ${data.latest_version}</strong></p>
                            <p>Current version: ${CURRENT_VERSION}</p>
                            <p>Release date: ${new Date(data.release_date).toLocaleDateString()}</p>
                            <h4>Release Notes:</h4>
                            <div style="max-height: 200px; overflow-y: auto; background: #f5f5f5; padding: 10px; border-radius: 5px;">
                                ${data.release_notes || 'No release notes provided.'}
                            </div>
                        </div>
                    `;
                    installBtn.style.display = 'block';
                    installBtn.dataset.downloadUrl = data.download_url;
                } else {
                    modalBody.innerHTML = `
                        <p>‚úÖ You are running the latest version (${CURRENT_VERSION})</p>
                    `;
                    installBtn.style.display = 'none';
                }
            } catch (error) {
                modalBody.innerHTML = `
                    <p>‚ö†Ô∏è Unable to check for updates</p>
                    <p style="color: #f44336; font-size: 12px;">${error.message}</p>
                `;
                installBtn.style.display = 'none';
            }
        }

        async function installUpdate() {
            const installBtn = document.getElementById('installUpdateBtn');
            const downloadUrl = installBtn.dataset.downloadUrl;
            
            if (!downloadUrl) return;
            
            installBtn.disabled = true;
            installBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Installing...';
            
            try {
                const response = await fetch(`${API_BASE}/system/update/install`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({download_url: downloadUrl})
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('‚úÖ Update installed successfully! The system will restart in 10 seconds.');
                    setTimeout(() => location.reload(), 10000);
                } else {
                    alert('‚ùå Update installation failed: ' + data.error);
                }
            } catch (error) {
                alert('‚ùå Update installation failed: ' + error.message);
            } finally {
                installBtn.disabled = false;
                installBtn.innerHTML = '<i class="fa-solid fa-download"></i> Install Update';
            }
        }

        // Initialize update system when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', setupUpdateSystem);
        } else {
            setupUpdateSystem();
        }
    </script>
    
    <!-- Language System -->
    <script src="js/language.js?v=1.0"></script>
    
    <!-- Page Load Handler -->
    <script>
        // Show loader on page load
        window.addEventListener('load', function() {
            const loader = document.getElementById('globalLoader');
            if (loader) {
                setTimeout(() => {
                    loader.classList.add('hidden');
                }, 500);
            }
        });
    </script>
</body>
</html>
